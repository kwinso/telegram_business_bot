# Бот для поиска в базе данных
Телеграм-бот для поиска людей в базе данных по заданным параметрам.
Данный бот умеет *подтверждать* оплату с помощью **QiWi**. Также существует такие способы оплаты: **Карта Сбербанк, Я.Деньги.**
Бот пришлёт оповещения в личные сообщения к указанному человеку, чтобы он мог подтвердить оплату.

## Установка
Для начала нужно склонировать код из этого репозитория:
```
  git clone https://github.com/uwumouse/telegram_business_bot.git
```
Итак, теперь у вас есть весь код, давайте обновим все зависимости:
```
  cd telegram_business_bod
  npm install 
````
Вот и всё, ваш бот готов к настройке.
## Настройка бота
Чтобы настроить бота, вам нужно заглянуть в файл под названием `bot_config.ini`, это тот самый файл, без которого ваш бот *не заработает*.  
В основном, всё уже написано, поясню только некоторые поля.

```
  QIWI_TOKEN='Здесь вам нужно указать специальный API токен для вашего кошелька, куда вы хотите, чтобы приходила оплата'
```
Токен вы можете взять прямо на сайте QiWi: https://qiwi.com/api  
Не забудьте указать *разрешение на просмотр истории кошелька*, иначе ничего не получится.  
Дальше:
```
  PHONE_NUMBER='Номер кошелька, куда будут приходить деньги'
  PAYMENT='Размер оплаты, целое число'
  ADMIN_ID="ID телеграм пользователя, который будет подтверждать оплату по Сбербанку или Яндекс"
```

## Как же работает бот?
- Первым делом, бот попривествует пользователя, предложив перейти к оплате или же посмотреть контакты. Измненить большинство сообщений можно в `~/Controllers/MessagesController.js` в `messages` и в экспортируемом классе.  
- Перейдя к оплате, бот предложит сделать выбор из доступных площадок.  
- Выбрав QiWi, в дело вступает бот, генерируя кодовое слово, а после ждёт оплату с этим кодовым словом, если оплата найдена, то бот разрешает доступ к работе.  
  С другими площадками всё полегче - админу приходит сообщение, в котором он должен нажать на кнопку подтверждения, после бот оповестит и пользователя и админа, что всё прошло успешно.
- Бот спрашивает ряд вопросов, давая возможность пропустить их, но нужно будет не меньше 2-х ответов, чтобы бот мог продолжить работу, это обусловлено работой API для поиска.  
- После бот отправит запрос к серверу, получив ошибку, попросит пользователя повторить заполнение данных, а если всё хорошо, то перейдёт к следующему шагу.  
- Когда данные получены, у пользователя есть выбор для вывода данных: **Excel, HTML, Текстовый файл**. Пользователь может сгенерировать таблицу любого вида, но только три раза, после бот завершает работу и просит оплату снова.
Можно завершить работу досрочно.
